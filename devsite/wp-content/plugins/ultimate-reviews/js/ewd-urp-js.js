function URPSetClickHandlers(){jQuery(".ewd-urp-product-name-text-input").on("keyup",function(){("undefined"==typeof autocompleteProductNames||null===autocompleteProductNames)&&(autocompleteProductNames="No"),("undefined"==typeof restrictProductNames||null===restrictProductNames)&&(restrictProductNames="No"),"Yes"==restrictProductNames&&(-1==jQuery.inArray(jQuery(".ewd-urp-product-name-text-input").val(),productNames)?(jQuery("#ewd-urp-restrict-product-names-message").html("Please make sure the product name matches exactly."),jQuery("#ewd-urp-review-submit").prop("disabled",!0)):(jQuery("#ewd-urp-restrict-product-names-message").html(""),jQuery("#ewd-urp-review-submit").prop("disabled",!1))),"Yes"==autocompleteProductNames&&(jQuery(".ewd-urp-product-name-text-input").autocomplete({source:productNames}),jQuery(".ewd-urp-product-name-text-input").val().length>1?jQuery(".ewd-urp-product-name-text-input").autocomplete("enable"):jQuery(".ewd-urp-product-name-text-input").autocomplete("disable"))}),jQuery(".ewd-urp-expandable-title").on("click",function(e){("undefined"==typeof accordionExpandable||null===accordionExpandable)&&(accordionExpandable="No");var r=jQuery(this).data("postid");if(jQuery("#ewd-urp-review-content-"+r).hasClass("ewd-urp-content-hidden"))var t="Open";else var t="Close";if("Yes"==accordionExpandable&&jQuery(".ewd-urp-review-content").addClass("ewd-urp-content-hidden"),"Close"==t)jQuery("#ewd-urp-review-content-"+r).addClass("ewd-urp-content-hidden");else{jQuery("#ewd-urp-review-content-"+r).removeClass("ewd-urp-content-hidden");var u="post_id="+r+"&action=urp_record_view";jQuery.post(ajaxurl,u,function(e){})}e.preventDefault()})}function URPSetKeyStrokeCounters(){jQuery(".ewd-urp-review-textarea").on("keyup",function(){var e=jQuery(this).data("textareacount"),r=jQuery(this).val().length;if(""!=ewd_urp_php_data.review_character_limit){var t="<label></label>Characters remaining: "+(parseInt(ewd_urp_php_data.review_character_limit)-r);r>ewd_urp_php_data.review_character_limit?(jQuery("#ewd-urp-review-submit").prop("disabled",!0),jQuery("#ewd-urp-review-character-count-"+e).css("color","red")):(jQuery("#ewd-urp-review-submit").prop("disabled",!1),jQuery("#ewd-urp-review-character-count-"+e).css("color","inherit")),jQuery("#ewd-urp-review-character-count-"+e).html(t)}})}function URPSetKarmaHandlers(){jQuery(".ewd-urp-karma-down").on("click",function(){var e=jQuery(this).data("reviewid");if("0"!=e){URPKarmaAJAX("down",e);var r=jQuery("#ewd-urp-karma-score-"+e).html();r--,jQuery("#ewd-urp-karma-score-"+e).html(r),jQuery(this).data("reviewid","0")}}),jQuery(".ewd-urp-karma-up").on("click",function(){var e=jQuery(this).data("reviewid");if("0"!=e){URPKarmaAJAX("up",e);var r=jQuery("#ewd-urp-karma-score-"+e).html();r++,jQuery("#ewd-urp-karma-score-"+e).html(r),jQuery(this).data("reviewid","0")}})}function URPKarmaAJAX(e,r){var t="Direction="+e+"&ReviewID="+r+"&action=urp_update_karma";jQuery.post(ajaxurl,t,function(e){})}function URPSetStarHandlers(){jQuery(".ewd-urp-star-input").on("click",function(){for(var e=jQuery(this).data("reviewscore"),r=jQuery(this).data("inputname"),t=jQuery(this).data("cssidadd"),u=1;u<=ewd_urp_php_data.maximum_score;)e>=u?jQuery("#ewd-urp-star-input-"+t+"-"+u).addClass("ewd-urp-star-input-filled"):jQuery("#ewd-urp-star-input-"+t+"-"+u).removeClass("ewd-urp-star-input-filled"),u++;jQuery("input[name='"+r+"']").val(e)})}function URPSetFilteringHandlers(){jQuery(".ewd-urp-filtering-toggle").on("click",function(){jQuery(".ewd-urp-filtering-controls").hasClass("ewd-urp-hidden")?(jQuery(".ewd-urp-filtering-controls").removeClass("ewd-urp-hidden"),jQuery(".ewd-urp-filtering-toggle").removeClass("ewd-urp-filtering-toggle-downcaret"),jQuery(".ewd-urp-filtering-toggle").addClass("ewd-urp-filtering-toggle-upcaret")):(jQuery(".ewd-urp-filtering-controls").addClass("ewd-urp-hidden"),jQuery(".ewd-urp-filtering-toggle").removeClass("ewd-urp-filtering-toggle-upcaret"),jQuery(".ewd-urp-filtering-toggle").addClass("ewd-urp-filtering-toggle-downcaret"))}),jQuery(".ewd-urp-filtering-select").on("change",function(e){URPFilterResults()}),jQuery("#ewd-urp-review-score-filter").slider({range:!0,min:1,max:ewd_urp_php_data.maximum_score,values:[1,ewd_urp_php_data.maximum_score],change:function(e,r){jQuery("#ewd-urp-score-range").text(r.values[0]+" - "+r.values[1]),URPFilterResults()}})}function URPFilterResults(e,r){var t=jQuery("#urp-search-string").val();if("All"==jQuery(".ewd-filtering-product-name").val()||void 0==jQuery(".ewd-filtering-product-name").val())var u=jQuery("#urp-product-name").val();else var u=jQuery(".ewd-filtering-product-name").val();if("All"==jQuery(".ewd-filtering-review-author").val()||void 0==jQuery(".ewd-filtering-review-author").val())var a=jQuery("#urp-review-author").val();else var a=jQuery(".ewd-filtering-review-author").val();if(0==jQuery(".ewd-urp-custom-filter").length)var i=jQuery("#urp-custom-filters").val();else{var n={};jQuery(".ewd-urp-custom-filter").each(function(){n[jQuery(this).data("fieldname")]=jQuery(this).val()});var i=JSON.stringify(n)}var l=jQuery("#ewd-urp-review-score-filter").slider("option","values"),o=l[0],d=l[1];void 0==o&&(o=0),void 0==d&&(d=1e6),void 0!==r&&(o=r),void 0!==r&&(d=r);var s=jQuery("#urp-orderby").val(),p=jQuery("#urp-order").val(),c=jQuery("#urp-post-count").val(),w=jQuery("#urp-current-page").val();void 0==w&&(w=1),"Yes"==e?jQuery(".urp-infinite-scroll-content-area").html("<h3>Retrieving results...</h3>"):jQuery(".ewd-urp-reviews-container").html("<h3>Retrieving results...</h3>");var v="Q="+t+"&product_name="+encodeURIComponent(u)+"&review_author="+a+"&custom_filters="+i+"&min_score="+o+"&max_score="+d+"&orderby="+s+"&order="+p+"&post_count="+c+"&current_page="+w+"&only_reviews=Yes&action=urp_search";jQuery.post(ajaxurl,v,function(r){r=r.substring(0,r.length-1),"Yes"==e?jQuery(".urp-infinite-scroll-content-area").replaceWith(r):jQuery(".ewd-urp-reviews-container").html(r),URPSetClickHandlers(),URPSetPaginationHandlers(),URPSetKarmaHandlers(),URPThumbnailReadMoreAJAXHAndler(),URPSetFlagInappropriateHandler(),URPPositionElements(),Filtering_Running="No"})}function URPSetPaginationHandlers(){jQuery(".ewd-urp-page-control").on("click",function(){var e=jQuery(this).data("controlvalue");"first"==e&&jQuery("#urp-current-page").val(1),"back"==e&&jQuery("#urp-current-page").val(Math.max(1,jQuery("#urp-current-page").val()-1)),"next"==e&&jQuery("#urp-current-page").val(Math.min(jQuery("#urp-max-page").val(),parseInt(jQuery("#urp-current-page").val())+1)),"last"==e&&jQuery("#urp-current-page").val(jQuery("#urp-max-page").val()),URPFilterResults()})}function URPSetToggleHandlers(){jQuery(".ewd-urp-submit-review-toggle").on("click",function(){jQuery(".ewd-urp-submit-review-toggle").addClass("ewd-urp-content-hidden"),jQuery(".ewd-urp-review-form").removeClass("ewd-urp-content-hidden")})}function URPInfiniteScroll(){jQuery(".ewd-urp-review-list").hasClass("urp-infinite-scroll")&&jQuery(window).scroll(function(){var e=jQuery(".urp-infinite-scroll-content-area").position();if(void 0!=e&&jQuery("#urp-max-page").val()!=parseInt(jQuery("#urp-current-page").val())&&jQuery(window).height()+jQuery(window).scrollTop()>e.top&&"No"==Filtering_Running){jQuery("#urp-current-page").val(Math.min(jQuery("#urp-max-page").val(),parseInt(jQuery("#urp-current-page").val())+1)),Filtering_Running="Yes";var r="Yes";URPFilterResults(r)}})}function URPFormSubmitHandler(){jQuery("#review_order").on("submit",function(e){""==jQuery("#ewd-urp-overall-score").val()&&(jQuery(".ewd-urp-submit").prepend("<div id='ewd-urp-submit-warning'>Please select a score before submitting the form.</div>"),setTimeout(function(){jQuery("#ewd-urp-submit-warning").remove()},5e3),e.preventDefault())})}function URPThumbnailReadMoreAJAXHAndler(){jQuery(".ewd-urp-thumbnail-read-more.Yes").on("click",function(e){var r=jQuery(this).data("postid"),t=r.substring(4);jQuery("#ewd-urp-review-"+r).html("Retrieving full review..."),jQuery(this).remove();var u="ID="+t+"&action=urp_thumbnail_ajax";jQuery.post(ajaxurl,u,function(e){jQuery("#ewd-urp-review-"+r).html(e),URPReadLessHandler()}),e.preventDefault()})}function URPReadLessHandler(){jQuery(".ewd-urp-ajax-read-less").off(),jQuery(".ewd-urp-ajax-read-less").on("click",function(){var e=jQuery(this).data("thumbnailchars"),r=jQuery(this).parent();jQuery(this).remove(),r.html(r.html().substring(0,e))})}function URPSetClickableSummaryHandler(){jQuery(".ewd-urp-summary-clickable").on("click",function(){var e=jQuery(this).data("reviewscore"),r=jQuery("#ewd-urp-review-score-filter").slider("option","values");void 0!==r[0]?(jQuery("#ewd-urp-review-score-filter").slider("values",0,e),jQuery("#ewd-urp-review-score-filter").slider("values",1,e)):(jQuery(this).parent().append("<div class='ewd-urp-remove-score-filter'>Show all review</div>"),URPFilterResults("No",e),jQuery(".ewd-urp-remove-score-filter").on("click",function(){jQuery(this).remove(),URPFilterResults()}))})}function URPSetFlagInappropriateHandler(){jQuery(".ewd-urp-flag-inappropriate").off("click"),jQuery(".ewd-urp-flag-inappropriate").on("click",function(){if(!jQuery(this).hasClass("ewd-urp-content-flagged")){jQuery(this).addClass("ewd-urp-content-flagged");var e=jQuery(this).data("reviewid"),r="ReviewID="+e+"&action=urp_flag_inappropriate";jQuery.post(ajaxurl,r,function(e){console.log(e)})}})}function URPPositionElements(){"Yes"==ewd_urp_php_data.flag_inappropriate_enabled&&jQuery(".ewd-urp-flag-inappropriate").show(),jQuery(".ewd-urp-review-header").each(function(){var e=jQuery(this),r=e.find(".ewd-urp-review-score").height(),t=e.find(".ewd-urp-review-score-number").height(),u=(r-t)/2,a=r/2-9,i=e.find(".ewd-urp-review-link").height(),n=(r-i)/2;e.find(".ewd-urp-review-score-number").css("margin-top",u+"px"),e.find(".ewd-urp-flag-inappropriate").css("margin-top",a+"px"),e.find(".ewd-urp-review-link").css("margin-top",n+"px")})}function URPSetWCTabSwitchers(){jQuery(".ewd-urp-wc-tab-title").on("click",function(){jQuery(".ewd-urp-wc-tab-title").removeClass("ewd-urp-wc-active-tab-title"),jQuery(this).addClass("ewd-urp-wc-active-tab-title"),jQuery(".ewd-urp-wc-tab").removeClass("ewd-urp-wc-active-tab");var e=jQuery(this).data("tab");jQuery('[data-tab="'+e+'"]').addClass("ewd-urp-wc-active-tab")})}function URPSetStarRequiredHandlers(){jQuery(".ewd-urp-review-form form").on("submit",function(e){jQuery(".ewd-urp-hidden.required").each(function(r,t){""==jQuery(this).val()&&(e.preventDefault(),jQuery(this).parent().prepend('<span class="urp-required">Please select a score</span>').focus())})})}var Filtering_Running="No";jQuery(function(){URPSetClickHandlers(),URPSetKeyStrokeCounters(),URPSetKarmaHandlers(),URPSetStarHandlers(),URPSetFilteringHandlers(),URPSetPaginationHandlers(),URPSetToggleHandlers(),URPInfiniteScroll(),URPFormSubmitHandler(),URPThumbnailReadMoreAJAXHAndler(),URPSetClickableSummaryHandler(),URPSetFlagInappropriateHandler(),URPPositionElements(),URPSetWCTabSwitchers(),URPSetStarRequiredHandlers(),jQuery("#urp-ajax-text-input").on("keyup",function(){var e=jQuery(".urp-text-input").val(),r=jQuery("#urp-search-product-name").val(),t=jQuery("#urp-search-orderby").val(),u=jQuery("#urp-search-order").val(),a=jQuery("#urp-search-post-count").val();void 0==r&&(r=""),jQuery("#urp-ajax-results").html("<h3>Retrieving results...</h3>");var i="Q="+e+"&product_name="+encodeURIComponent(r)+"&orderby="+t+"&order="+u+"&post_count="+a+"&action=urp_search";jQuery.post(ajaxurl,i,function(e){e=e.substring(0,e.length-1),jQuery("#urp-ajax-results").html(e),URPSetClickHandlers(),URPSetFilteringHandlers(),URPSetKarmaHandlers(),URPSetPaginationHandlers(),URPSetFlagInappropriateHandler(),URPPositionElements()})})});